<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate Invoice / Quote</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
  margin: 0;
  background: #ffffff;
  color: #2b2b2b;
}

.header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 26px;
  font-size: 18px;
  font-weight: 600;
  color: #ffffff;
  background-color: #6B2737;
}

.container {
  padding: 38px;
}

label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 6px;
}

input, select {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #e5dada;
  background: #f7f3f4;
  font-size: 14px;
  margin-bottom: 14px;
}

.row {
  display: block;
}

.add-item {
  border: 1.5px dashed #e5dada;
  padding: 14px;
  text-align: center;
  border-radius: 12px;
  font-size: 14px;
  color: #6B2737;
  margin: 12px 0 20px;
  cursor: pointer;
}

.item {
  border: 1px solid #e5dada;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
  background: #fff;
}

.footer {
  padding: 16px 38px;
}

.save-btn {
  width: 100%;
  padding: 16px;
  border-radius: 999px;
  border: none;
  background: linear-gradient(135deg, #6B2737, #8C3A4F);
  color: #fff;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<div class="header" id="pageTitle">Generate Invoice / Quote</div>

<div class="container">

  <!-- Document Type -->
  <label>Document Type</label>
  <select id="docType" onchange="toggleType()">
    <option value="invoice">Invoice</option>
    <option value="quote">Quote</option>
  </select>

  <label>Company Name</label>
  <input id="companyName" type="text">

  <label>Company Address</label>
  <input id="companyAddress" type="text">

  <label>Client Name</label>
  <input id="clientName" type="text">

  <label>Client Address</label>
  <input id="clientAddress" type="text">

  <div id="invoiceFields">
    <label>Invoice Number</label>
    <input id="invoiceNumber" type="text" placeholder="INV-001">

    <label>Issue Date</label>
    <input id="issueDate" type="date">

    <label>Due Date</label>
    <input id="dueDate" type="date">

    <label>Status</label>
    <select id="status">
      <option>Draft</option>
      <option>Sent</option>
      <option>Paid</option>
      <option>Overdue</option>
      <option>Cancelled</option>
    </select>
  </div>

  <div id="items"></div>
  <div class="add-item" onclick="addItem()">+ Add Item</div>

  <div id="vatField">
    <label>Select VAT %</label>
    <select id="vat" onchange="calculateTotal()">
      <option value="20">20%</option>
      <option value="15">15%</option>
      <option value="10">10%</option>
      <option value="0">0%</option>
    </select>
  </div>

  <div id="paymentFields">
    <label>Payment Terms</label>
    <input id="paymentTerms" type="text" placeholder="Net 30">

    <label>Bank Details / Payment Method</label>
    <input id="bankDetails" type="text">
  </div>

  <label>Note (Optional)</label>
  <input id="note" type="text">

</div>

<div class="footer">
  <button class="save-btn" onclick="generatePDF()" id="saveBtn">Save Invoice PDF</button>
</div>

<script>
let itemCount = 0;

function toggleType() {
  const type = document.getElementById("docType").value;
  const invoiceFields = document.getElementById("invoiceFields");
  const paymentFields = document.getElementById("paymentFields");
  const vatField = document.getElementById("vatField");

  if (type === "quote") {
    invoiceFields.classList.add("hidden");
    paymentFields.classList.add("hidden");
    vatField.classList.add("hidden");
    document.getElementById("pageTitle").innerText = "Generate Quote";
    document.getElementById("saveBtn").innerText = "Save Quote PDF";
  } else {
    invoiceFields.classList.remove("hidden");
    paymentFields.classList.remove("hidden");
    vatField.classList.remove("hidden");
    document.getElementById("pageTitle").innerText = "Generate Invoice";
    document.getElementById("saveBtn").innerText = "Save Invoice PDF";
  }
}

function addItem() {
  itemCount++;
  document.getElementById("items").insertAdjacentHTML("beforeend", `
    <div class="item">
      <label>Item # ${itemCount}</label>
      <input class="item-name" placeholder="Item name">
      <input class="item-desc" placeholder="Description">
      <label>Quantity</label>
      <input class="item-qty" type="number" value="1" oninput="calculateTotal()">
      <label>Unit Price</label>
      <input class="item-price" type="number" value="0" oninput="calculateTotal()">
      <label>Total Amount in $</label>
      <input class="item-total" readonly>
    </div>
  `);
}

function calculateTotal() {
  let subtotal = 0;
  document.querySelectorAll(".item").forEach(item => {
    const qty = item.querySelector(".item-qty").value;
    const price = item.querySelector(".item-price").value;
    const total = qty * price;
    item.querySelector(".item-total").value = total.toFixed(2);
    subtotal += total;
  });
  return subtotal;
}

function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 20;

  const docType = document.getElementById("docType").value;

  /* ===== TITLE ===== */
  doc.setFontSize(18);
  doc.text(docType === "invoice" ? "INVOICE" : "QUOTE", 14, y);

  if (docType === "invoice") {
    doc.setFontSize(11);
    doc.text(`Invoice #: ${invoiceNumber.value}`, 150, y);
    y += 6;
    doc.text(`Issue Date: ${issueDate.value}`, 150, y);
    y += 6;
    doc.text(`Due Date: ${dueDate.value}`, 150, y);
  }

  y += 14;

  /* ===== FROM / TO ===== */
  doc.setFontSize(12);
  doc.text("From:", 14, y);
  doc.text("To:", 120, y);
  y += 6;

  doc.setFontSize(11);
  doc.text(companyName.value, 14, y);
  doc.text(clientName.value, 120, y);
  y += 6;

  doc.text(companyAddress.value, 14, y);
  doc.text(clientAddress.value, 120, y);

  y += 12;

  /* ===== ITEMS HEADER ===== */
  doc.setFontSize(12);
  doc.text("Items", 14, y);
  y += 6;

  doc.setFontSize(11);
  doc.text("Item", 14, y);
  doc.text("Qty", 110, y);
  doc.text("Price", 130, y);
  doc.text("Total", 170, y);

  y += 3;
  doc.line(14, y, 195, y);
  y += 6;

  /* ===== ITEMS LIST ===== */
  document.querySelectorAll(".item").forEach(item => {
    const name = item.querySelector(".item-name").value;
    const qty = item.querySelector(".item-qty").value;
    const price = item.querySelector(".item-price").value;
    const total = item.querySelector(".item-total").value;

    doc.text(name, 14, y);
    doc.text(qty, 110, y);
    doc.text(`$${price}`, 130, y);
    doc.text(`$${total}`, 170, y);
    y += 6;
  });

  y += 4;
  doc.line(14, y, 195, y);
  y += 8;

  /* ===== TOTALS ===== */
  const subtotal = calculateTotal();
  doc.text(`Subtotal: $${subtotal.toFixed(2)}`, 130, y);
  y += 6;

  if (docType === "invoice") {
    const vatPercent = Number(vat.value);
    const vatAmount = subtotal * vatPercent / 100;

    doc.text(`VAT (${vatPercent}%): $${vatAmount.toFixed(2)}`, 130, y);
    y += 6;
    doc.setFontSize(12);
    doc.text(`Total: $${(subtotal + vatAmount).toFixed(2)}`, 130, y);
  } else {
    doc.setFontSize(12);
    doc.text(`Estimated Total: $${subtotal.toFixed(2)}`, 130, y);
  }

  y += 12;

  /* ===== PAYMENT / NOTE ===== */
  doc.setFontSize(11);

  if (docType === "invoice") {
    doc.text(`Payment Terms: ${paymentTerms.value}`, 14, y);
    y += 6;
    doc.text(`Payment Method: ${bankDetails.value}`, 14, y);
  }

  if (note.value) {
    y += 8;
    doc.text(`Note: ${note.value}`, 14, y);
  }

  /* ===== SAVE ===== */
  doc.save(docType + ".pdf");
}
</script>

</body>
</html>
